# **CPU卡  认证**
![apaki](../../apaki.jpg)
`2018.04.16 by jianfeng`
#### 知识来源：[m0_37834827的博客](https://blog.csdn.net/m0_37834827/article/details/64440805)

### 主要认证操作
> 基于对称密钥的认证操作
- 口令认证(或 PIN认证)
- 内部认证
- 外部认证


### 详解
- 口令认证
	> 用户输入口令参数后，由Verify命令核对口令正确性
	
	通过判断密码文件中的错误计数器是否达最大值，若是，则锁定卡。若否，则比较密码。判断密码合法性，若不符合，则需要将错误计数器+1

- 内部认证
	> 读卡器验证CPU卡合法性
	1. 读卡器生成随机数并发送给CPU卡
	2. CPU卡用内部认证密钥计算随机数，得到随机数密文
	3. CPU卡将随机数密文发送给读卡器
	4. 读写器解密随机数密文，得到随机数明文
	5. 读卡器把解密后的随机数明文和步骤1生成的随机数对比。若相等则认证成功

- 外部认证
	> CPU卡认证读卡器合法性
	1. 读卡器发送GetChallenge命令，随后CPU卡返回随机数
	2. 读卡器用内部认证密钥计算随机数，得到随机数密文。
	3. 读卡器将随机数密文发送给CPU卡
	4. CPU卡解密随机数密文，得到随机数明文
	5. CPU卡把解密后的随机数明文和步骤1生成的随机数对比。若相等则认证成功


### 其他问题
- 密钥分散问题
	> 由于一个读卡器必须可以认证多张卡片，而各个卡片密钥也都不同
	- 想法1：1个读卡器存储所有卡的密钥(不现实)
	- 想法2：n个读卡器分别对应n个卡，代价高，不现实
	-[密钥学方法]读卡器中存放的是用户卡的母密钥，每次认证的时候，由母密钥根据用户卡的标识计算得到用户卡的密钥。
